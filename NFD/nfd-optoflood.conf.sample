; Sample NFD configuration with OptoFlood support
; This configuration enables the OptoFlood flooding mechanism for producer mobility

general
{
  ; Specify the log level
  ; Valid levels: TRACE, DEBUG, INFO, WARN, ERROR, FATAL, NONE
  ; Default: INFO
  log-level INFO
}

tables
{
  ; Content Store capacity
  cs_max_packets 65536

  ; Set the CS replacement policy
  ; Valid policies: lru, priority_fifo
  ; Default: lru
  cs_policy lru

  ; Set the forwarding strategy for the root namespace
  strategy_choice
  {
    / /localhost/nfd/strategy/best-route
  }
}

; OptoFlood configuration
; This section controls the OptoFlood flooding mechanism
optoflood
{
  ; Enable OptoFlood
  ; Default: false
  enabled true
  
  ; Maximum hop limit for flooded packets
  ; Default: 3
  hop-limit 3
  
  ; Rate limit for flooding (packets per second)
  ; Default: 100
  rate-limit 100
  
  ; TFIB entry lifetime in milliseconds
  ; Default: 1000 (1 second)
  tfib-lifetime 1000
  
  ; Interest flooding configuration
  interest-flooding
  {
    ; Enable Interest flooding
    ; Default: true (when OptoFlood is enabled)
    enabled true
    
    ; Number of consecutive failures to trigger flooding
    ; Default: 3
    consecutive-failures 3
  }
  
  ; Data flooding configuration
  data-flooding
  {
    ; Enable Data flooding
    ; Default: true (when OptoFlood is enabled)
    enabled true
    
    ; Enable guided flooding using trace hints
    ; Default: true
    guided-flooding true
  }
}

face_system
{
  ; The general section configures properties shared by all faces
  general
  {
    enable_congestion_marking yes
  }

  ; TCP faces
  tcp
  {
    listen yes
    port 6363
    enable_v4 yes
    enable_v6 yes
  }

  ; UDP faces  
  udp
  {
    listen yes
    port 6363
    enable_v4 yes
    enable_v6 yes
  }

  ; Unix stream faces
  unix
  {
    listen yes
    path /run/nfd/nfd.sock
  }

  ; Ethernet faces
  ether
  {
    listen yes
    
    ; Multicast groups
    mcast yes
    mcast_group 01:00:5E:00:17:AA
    mcast_ad_hoc no
  }

  ; WebSocket faces
  websocket
  {
    listen yes
    port 9696
    enable_v4 yes
    enable_v6 yes
  }
}

; Authorization section
authorizations
{
  authorize
  {
    certfile any
    privileges
    {
      faces
      fib
      cs
      strategy-choice
    }
  }
}

rib
{
  ; Configure automatic prefix registration
  auto_prefix_propagate
  {
    cost 15
    timeout 10000
    refresh_interval 300
    ; OptoFlood entries should have lower cost for faster recovery
    optoflood_cost 5
  }
}
