# Solution Experiment Vagrantfile

Vagrant.configure("2") do |config|
  solution_box_path = ENV['ACTUAL_SOLUTION_BOX_PATH'] || "box/solution/solution.box"
  config.vm.box = solution_box_path

  config.vm.network "private_network", type: "dhcp"

  common_cpus   = 4
  common_memory = 4096

  config.vm.provider :virtualbox do |vb|
    vb.name = "exp-solution-virtualbox"
    vb.cpus = common_cpus
    vb.memory = common_memory
    vb.customize ["modifyvm", :id, "--vram", "256"]
    vb.gui = false
  end

  config.vm.provider :libvirt do |lv|
    lv.driver = "kvm"
    require 'etc'
    dirname = __dir__.split('/')[-2..-1].join('-')
    lv.default_prefix = "#{Etc.getpwuid.uid}-#{dirname}-"
    lv.cpus   = common_cpus
    lv.memory = common_memory
  end

  # Clone the flooding repository
  config.vm.provision "shell", inline: <<-SHELL
    if [ ! -d "/home/vagrant/mini-ndn/flooding" ]; then
      git clone https://github.com/TheBigRedOne/flooding.git /home/vagrant/mini-ndn/flooding
      # Ensure vagrant user owns all experiment files
      chown -R vagrant:vagrant /home/vagrant/mini-ndn/flooding
    fi
  SHELL

end
