# Solution Experiment Vagrantfile

Vagrant.configure("2") do |config|
  solution_box_path = ENV['ACTUAL_SOLUTION_BOX_PATH'] || "boxes/solution/solution.box"
  config.vm.box = solution_box_path

  config.vm.network "private_network", type: "dhcp"

  common_cpus   = 4
  common_memory = 4096

  config.vm.provider :virtualbox do |vb|
    vb.name = "exp-solution-virtualbox"
    vb.cpus = common_cpus
    vb.memory = common_memory
    vb.customize ["modifyvm", :id, "--vram", "256"]
    vb.gui = false
  end

  config.vm.provider :libvirt do |lv|
    lv.driver = "kvm"
    lv.name   = "exp-solution-kvm"
    lv.cpus   = common_cpus
    lv.memory = common_memory
  end

   # Explicitly transfer host files to VM
  config.vm.provision "file", source: "../../experiment/app", destination: "/home/vagrant/mini-ndn/flooding/experiment/app"
  config.vm.provision "file", source: "../../experiment/tool", destination: "/home/vagrant/mini-ndn/flooding/experiment/tool"
  config.vm.provision "file", source: "Makefile", destination: "/home/vagrant/mini-ndn/flooding/experiment/solution/Makefile"

  config.vm.provision "shell", inline: <<-SHELL
    mkdir -p /home/vagrant/mini-ndn/flooding/experiment/solution
    mkdir -p /home/vagrant/mini-ndn/flooding/experiment/app
    mkdir -p /home/vagrant/mini-ndn/flooding/experiment/tool
    # Ensure vagrant user owns all experiment files
    chown -R vagrant:vagrant /home/vagrant/mini-ndn/flooding/experiment
  SHELL

end
